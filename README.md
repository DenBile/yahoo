# Yahoo scrapper

This project comprises two primary components. Firstly, it involves connecting to Yahoo Finance to retrieve data for a specified ticker. The data obtained from the API is stored in an Excel file, containing the date and closing price information. Secondly, the project facilitates the transmission of this data to another server using the TCP protocol.

## Table of Contents

- [Introduction](#introduction)
- [Installation](#installation)
- [Project Structure](#structure)
- [Usage](#usage)
- [Documentation](#documentation)
- [Testing](#testing)
- [License](#license)

## Introduction

### Part A

**User Input:**
Users can specify a ticker, report range, and log level.
Ticker input undergoes regex verification to prevent invalid entries.
Report range and log level have predefined choices to minimize errors.

**Data Retrieval:**
The script connects to Yahoo Finance to retrieve data for the specified ticker and range.
Default values are used for arguments if the user doesn't provide any.

**Data Processing:**
Retrieved data is formatted into an Excel file.
Unnecessary columns are dropped, and the "Date" column is formatted to YYYY-MM-DD.

**File Management:**
The script checks if an Excel file for the specified ticker already exists.
If the file doesn't exist, a new one is created.
If the file is empty, the retrieved data is added, and the script exits.
If the file contains data, the script checks for the latest date.
If there is a gap between the latest date in the file and the retrieved data, the script exits to avoid data discrepancies.
Otherwise, the script appends missing data to the existing file.

**Detailed Description:**
The project's first task involves retrieving financial data from Yahoo Finance based on user-specified parameters. Users can define a ticker symbol, report range, and logging level. The script ensures the validity of the ticker symbol and offers predefined options for the report range and logging level to prevent input errors.

Upon execution, the script connects to the Yahoo Finance API to fetch the requested data. This data is then processed, with unnecessary columns removed and the date format standardized. Subsequently, the script manages the output Excel file.

If the Excel file for the specified ticker doesn't exist, the script creates a new one. In cases where the file already exists, the script checks for data consistency. If the file is empty, the retrieved data is directly added. However, if the file contains existing data, the script verifies if there's a chronological gap between the latest date in the file and the retrieved data. If such a gap exists, the script exits to prevent data inconsistencies. Otherwise, it appends the missing data to the file.

Throughout execution, the script ensures error handling by raising exceptions in case of any unexpected issues.

### Part B

**Excel File Transmission:**
The second script transmits the Excel file generated by the first script to a remote server via TCP protocol.
Users can provide optional arguments such as ticker, log level, server, and port to customize the script's behavior.
Default values are set for all arguments to enhance flexibility.

**Detailed Description:**
The second script builds upon the output of the first script, transmitting the Excel file to a remote server using the TCP protocol. It offers users the flexibility to customize its behavior through optional arguments. These arguments include ticker, log level, server address, and port number, with default values provided for convenience. The ticker parameter serves as an identifier for the file, facilitating tracking of multiple companies if needed.

The script establishes a connection between the client and server sides, utilizing a custom module to streamline the process and enhance reusability. Once the connection is established, the script sends the data in packages. If the data size exceeds the capacity of a single package, multiple batches are transmitted. Upon receiving all data packages, the server confirms successful transmission, which is then logged on the client side.

To serialize the data for transmission, the script utilizes pickling. This serialization method ensures efficient and platform-independent data transfer.

To manage potential delays or unresponsiveness, the script incorporates a timeout mechanism. If the client fails to receive a response from the server within 0.5 seconds after sending all packages, a timeout exception is raised.

Additionally, the script handles disconnection gracefully. If the client sends a disconnection message to the server, the server closes the connection with that specific client.

**Note:**
A helper script and server-side component were developed to test and validate the data transmission process, ensuring that data is sent and handled as expected.

## Structure

```
logs/
reports/
venv/
src/
│
├── models/
│   ├── __init__.py
│   ├── arguments.py
│   ├── log_level.py
│   ├── no_dir_exception.py
│   └── report.py
│
├── modules/
│   ├── socket/
│   │   ├── client
│   │   ├── server
│   │   └── tcp
│   ├── __init__.py
│   ├── arguments.py
│   ├── chunker.py
│   ├── date.py
│   ├── directory.py
│   ├── file.py
│   ├── logger.py
│   └── reports.py
│
├── tests/
│   ├── __init__.py
│   ├── test_arguments.py
│   ├── test_date.py
│   ├── test_directory.py
│   ├── test_file.py
│   └── test_logger.py
│
├── __init__.py
├── package_receiver.py
├── package_sender.py
├── yahoo_scrapper.py
├── README.md
└── requirements.txt
```

## Installation

Prerequisites:
Python 3.12.0 or higher is required to run this project.

To set up the project environment, follow these steps:

Create a Virtual Environment:
Execute the following command outside the src directory to create a virtual environment named yahoo_venv:

```bash
python -m venv yahoo_venv
```

Activate the Virtual Environment:

On Windows:

```bash
yahoo_venv\Scripts\activate
```

On Linux:

```bash
. yahoo_venv/bin/activate
```

Install Dependencies:
Run the following command to install the required dependencies from the requirements.txt file:

```bash
pip install -r requirements.txt
```

Once you have completed these steps, you're ready to run the project!

## Usage

Once the virtual environment is activated and all the requirements are installed, you can execute the following command from the src directory to fetch data for a ticker from Yahoo Finance:

```bash
python yahoo_scrapper.py
```

To view all available arguments, execute:

```bash
python yahoo_scrapper.py --help
```

By default, the log level is set to INFO. However, you can modify it to one of the following levels: DEBUG, INFO, WARNING, ERROR, or CRITICAL. Additionally, the default reporting range is set to 12 months, as this is provided by Yahoo Finance when clicking the "Download" button. Available options for the reporting range are: 1mo, 2mo, 3mo, 6mo, 12mo, 24mo, and max.

To send data to the server, follow these steps:

Server Side:
After activating your virtual environment and navigating to the src directory, execute the following command to start the server:

```bash
python package_receiver.py
```

This will create a server that listens for connections on the default host:port. You can modify these values by passing different arguments to the script.

Client Side:
In a separate terminal, activate your virtual environment and navigate to the src directory. Then, execute the following command to start the client:

```bash
python package_sender.py
```

**Important Note: The server side must establish a connection before the client side attempts to send packages, otherwise the client side will crash, as this behavior is expected.**

By default, the host is set to 127.0.0.1 and the port is set to 30000. These values can be modified by passing different arguments to the scripts.

## Testing

To run the unit tests, execute the following command from the project root directory:

```bash
python -m unittest discover -s tests -v
```

## License

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

© 2024 Denys Biletskyy
